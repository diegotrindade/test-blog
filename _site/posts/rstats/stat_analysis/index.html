<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-0.9.434">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Diego P.F. Trindade">
<meta name="dcterms.date" content="2020-07-15">

<title>Diego P.F. Trindade - #3 Statistical analysis in ecology with broom</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link class="quarto-color-scheme" id="quarto-text-highlighting-styles" href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet">
<link class="quarto-color-scheme quarto-color-alternate" rel="prefetch" id="quarto-text-highlighting-styles" href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link class="quarto-color-scheme" href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet">
<link class="quarto-color-scheme quarto-color-alternate" rel="prefetch" href="../../../site_libs/bootstrap/bootstrap-dark.min.css">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

<script type="text/javascript">

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-143198225-1', 'auto');

ga('send', {
  hitType: 'pageview',
  'anonymizeIp': true,
});
</script>


<link rel="stylesheet" href="../../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Diego P.F. Trindade</span>
  </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../about/index.html">Home</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../posts/index.html">Posts</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../publications/index.html">Publications</a>
  </li>  
</ul>
              <div class="quarto-toggle-container">
                  <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">#3 Statistical analysis in ecology with <code>broom</code></h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Diego P.F. Trindade </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">July 15, 2020</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#broom-package" id="toc-broom-package" class="nav-link active" data-scroll-target="#broom-package"><code>broom</code> package</a>
  <ul class="collapse">
  <li><a href="#tidy" id="toc-tidy" class="nav-link" data-scroll-target="#tidy"><code>tidy()</code></a></li>
  <li><a href="#glance" id="toc-glance" class="nav-link" data-scroll-target="#glance"><code>glance()</code></a></li>
  <li><a href="#augment" id="toc-augment" class="nav-link" data-scroll-target="#augment"><code>augment()</code></a></li>
  </ul></li>
  <li><a href="#nested-models" id="toc-nested-models" class="nav-link" data-scroll-target="#nested-models">Nested models</a></li>
  <li><a href="#generating-tables-from-model-output" id="toc-generating-tables-from-model-output" class="nav-link" data-scroll-target="#generating-tables-from-model-output">Generating tables from model output</a></li>
  <li><a href="#bootstrap-with-modelr" id="toc-bootstrap-with-modelr" class="nav-link" data-scroll-target="#bootstrap-with-modelr">Bootstrap with <code>modelr</code></a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="featured.png" class="img-fluid figure-img"></p>
<p></p><figcaption aria-hidden="true" class="figure-caption">Image credit: Alisson Horst</figcaption><p></p>
</figure>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages(c("here", "dplyr", "vroom", "tidyr", "purrr")) #1st post</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages(c("ggplot2", "cowplot", "glue", "ggtext", "ggrepel")) #2nd post</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages(c("broom", "modelr", "mgcv", "pander")) #3rd post</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(modelr)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mgcv)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pander)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glue)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="broom-package" class="level1">
<h1><code>broom</code> package</h1>
<p><code>broom</code> organizes the messy output we get from <code>summary(model)</code>, giving us a <code>tibble</code> with different parameters present in our models. <code>broom</code> also supports working within lists, as we have seen in our previous posts. In short, when we need to perform several statistical analysis, with <code>broom</code>, we can nest the variables and run them all at once. To start, this package has three main functions <code>tidy()</code>, <code>glance()</code> and <code>augment()</code>. Each one gives us different parameters.</p>
<p>As the package’s page says:</p>
<p><code>tidy()</code> summarizes information about model components <code>glance()</code> reports information about the entire model <code>augment()</code> adds informations about observations to a dataset</p>
<p>Let’s check them out. I will keep using the data frame <code>rich_plot</code>, we were evaluating last time. I will build a non-sense linear model here, using species richness and year.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> rich_plot <span class="sc">%&gt;%</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(richness <span class="sc">~</span> year, .)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Using the traditional way, we can check the output of our model with <code>summary()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = richness ~ year, data = .)

Residuals:
   Min     1Q Median     3Q    Max 
-77.25 -48.53 -30.36  -4.44 814.31 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -759.78221  171.14066  -4.440 9.43e-06 ***
year           0.41619    0.08628   4.824 1.50e-06 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 93.61 on 2364 degrees of freedom
Multiple R-squared:  0.009747,  Adjusted R-squared:  0.009328 
F-statistic: 23.27 on 1 and 2364 DF,  p-value: 1.499e-06</code></pre>
</div>
</div>
<section id="tidy" class="level2">
<h2 class="anchored" data-anchor-id="tidy"><code>tidy()</code></h2>
<p>With <code>broom</code> we get the same but more organized. Using <code>tidy()</code>, we get the same as in <code>Coefficients</code> in the <code>summary(...)</code> output: estimates of our model, error, t value and p value</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 5
  term        estimate std.error statistic    p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
1 (Intercept) -760.     171.         -4.44 0.00000943
2 year           0.416    0.0863      4.82 0.00000150</code></pre>
</div>
</div>
</section>
<section id="glance" class="level2">
<h2 class="anchored" data-anchor-id="glance"><code>glance()</code></h2>
<p><code>glance()</code> gives us the final part of the <code>summary(..)</code> output: r squared, Residual standard error, F-statistic, degrees of freedom etc, but also AIC values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glance</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 12
  r.squared adj.r.squared sigma statistic    p.value    df  logLik    AIC    BIC
      &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
1   0.00975       0.00933  93.6      23.3 0.00000150     1 -14096. 28197. 28215.
# ℹ 3 more variables: deviance &lt;dbl&gt;, df.residual &lt;int&gt;, nobs &lt;int&gt;</code></pre>
</div>
</div>
</section>
<section id="augment" class="level2">
<h2 class="anchored" data-anchor-id="augment"><code>augment()</code></h2>
<p>Whereas <code>augment</code> gives us fitted values, residuals etc.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2,366 × 8
   richness  year .fitted  .resid    .hat .sigma      .cooksd .std.resid
      &lt;int&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;        &lt;dbl&gt;      &lt;dbl&gt;
 1       26  1923    40.5 -14.5   0.00352   93.6 0.0000428      -0.156  
 2       27  1926    41.8 -14.8   0.00322   93.6 0.0000405      -0.158  
 3       21  1927    42.2 -21.2   0.00313   93.6 0.0000808      -0.227  
 4       27  1929    43.0 -16.0   0.00294   93.6 0.0000434      -0.172  
 5       34  1930    43.5  -9.46  0.00285   93.6 0.0000146      -0.101  
 6       30  1931    43.9 -13.9   0.00276   93.6 0.0000305      -0.148  
 7       45  1932    44.3   0.707 0.00267   93.6 0.0000000765    0.00756
 8       50  1933    44.7   5.29  0.00258   93.6 0.00000415      0.0566 
 9       49  1934    45.1   3.87  0.00250   93.6 0.00000215      0.0414 
10       50  1935    45.5   4.46  0.00241   93.6 0.00000275      0.0477 
# ℹ 2,356 more rows</code></pre>
</div>
</div>
</section>
</section>
<section id="nested-models" class="level1">
<h1>Nested models</h1>
<p>Now that we are kinda introduced to the main functions present in <code>broom</code>, let’s build the same model but based on each taxa we have. For that, we have to nest our data by <code>TAXA</code> and then use <code>mutate()</code> to create a new column (<code>'model'</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>broom_mod<span class="ot">&lt;-</span>rich_plot <span class="sc">%&gt;%</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n_year<span class="sc">&gt;</span><span class="dv">30</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">group_by</span>(TAXA) <span class="sc">%&gt;%</span> </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="fu">nest</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>All information we have is nested within the column <code>data</code>. Now we can use <code>map()</code> to go into this column. We can use the same approach we did for the nested plots, using <code>mutate()</code> to create a new column (“model”) and <code>map()</code> to perform the model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>nested_models<span class="ot">&lt;-</span>broom_mod <span class="sc">%&gt;%</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">map</span>(data, <span class="sc">~</span><span class="fu">lm</span>(richness <span class="sc">~</span> year, <span class="at">data=</span>.x)))</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>nested_models</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
# Groups:   TAXA [4]
  TAXA                 data               model 
  &lt;chr&gt;                &lt;list&gt;             &lt;list&gt;
1 Birds                &lt;tibble [356 × 6]&gt; &lt;lm&gt;  
2 Fish                 &lt;tibble [386 × 6]&gt; &lt;lm&gt;  
3 Marine invertebrates &lt;tibble [144 × 6]&gt; &lt;lm&gt;  
4 Terrestrial plants   &lt;tibble [211 × 6]&gt; &lt;lm&gt;  </code></pre>
</div>
</div>
<p>Now we have both data and model’s column nested. We need to use one of the <code>broom</code>’s functions here to get the information. Let’s use <code>tidy</code>, for example. For that, we simply create a new column, using the same approach <code>mutate()</code> and <code>map()</code>, saying that we want to access the column <code>model</code> and get the <code>tidy</code> output. Finally we unnest the column we just created with <code>unnest()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>nested_models <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">coefs =</span> <span class="fu">map</span>(model, tidy, <span class="at">conf.int =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(coefs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 10
# Groups:   TAXA [4]
  TAXA       data     model term  estimate std.error statistic  p.value conf.low
  &lt;chr&gt;      &lt;list&gt;   &lt;lis&gt; &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
1 Birds      &lt;tibble&gt; &lt;lm&gt;  (Int… -5.02e+2   64.2        -7.81 6.63e-14 -6.28e+2
2 Birds      &lt;tibble&gt; &lt;lm&gt;  year   2.66e-1    0.0325      8.18 5.00e-15  2.02e-1
3 Fish       &lt;tibble&gt; &lt;lm&gt;  (Int… -8.89e+2  262.         -3.39 7.71e- 4 -1.40e+3
4 Fish       &lt;tibble&gt; &lt;lm&gt;  year   4.78e-1    0.132       3.62 3.33e- 4  2.19e-1
5 Marine in… &lt;tibble&gt; &lt;lm&gt;  (Int… -1.89e+3  476.         -3.97 1.15e- 4 -2.83e+3
6 Marine in… &lt;tibble&gt; &lt;lm&gt;  year   9.83e-1    0.241       4.08 7.43e- 5  5.07e-1
7 Terrestri… &lt;tibble&gt; &lt;lm&gt;  (Int… -3.60e+3  389.         -9.25 2.65e-17 -4.37e+3
8 Terrestri… &lt;tibble&gt; &lt;lm&gt;  year   1.87e+0    0.198       9.47 6.02e-18  1.48e+0
# ℹ 1 more variable: conf.high &lt;dbl&gt;</code></pre>
</div>
</div>
<p>We could also use <code>glance</code> instead of <code>tidy</code> if we want the .fitted values, for example</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>nested_models <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">gl =</span> <span class="fu">map</span>(model, glance, <span class="at">conf.int =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(gl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 15
# Groups:   TAXA [4]
  TAXA     data     model r.squared adj.r.squared sigma statistic  p.value    df
  &lt;chr&gt;    &lt;list&gt;   &lt;lis&gt;     &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
1 Birds    &lt;tibble&gt; &lt;lm&gt;     0.159         0.157   13.2      67.0 5.00e-15     1
2 Fish     &lt;tibble&gt; &lt;lm&gt;     0.0330        0.0305  53.4      13.1 3.33e- 4     1
3 Marine … &lt;tibble&gt; &lt;lm&gt;     0.105         0.0987  68.7      16.7 7.43e- 5     1
4 Terrest… &lt;tibble&gt; &lt;lm&gt;     0.300         0.297   86.8      89.8 6.02e-18     1
# ℹ 6 more variables: logLik &lt;dbl&gt;, AIC &lt;dbl&gt;, BIC &lt;dbl&gt;, deviance &lt;dbl&gt;,
#   df.residual &lt;int&gt;, nobs &lt;int&gt;</code></pre>
</div>
</div>
<p>We use the same approach for different models. Let’s perform, for example, a gam model, getting the coefs and r squared of each model, now using only one nested function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>rich_plot <span class="sc">%&gt;%</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n_year<span class="sc">&gt;</span><span class="dv">30</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">group_by</span>(TAXA) <span class="sc">%&gt;%</span> </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="fu">nest</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">map</span>(data, <span class="sc">~</span><span class="fu">gam</span>(richness <span class="sc">~</span> <span class="fu">s</span>(year, <span class="at">bs =</span> <span class="st">"cs"</span>,<span class="at">k=</span><span class="sc">-</span><span class="dv">1</span>), <span class="at">data=</span>.x)),</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">coefs =</span> <span class="fu">map</span>(model, tidy, <span class="at">conf.int =</span> <span class="cn">TRUE</span>),</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">Rsq =</span> <span class="fu">map_dbl</span>(model, <span class="sc">~</span><span class="fu">summary</span>(.)<span class="sc">$</span>r.sq)) <span class="sc">%&gt;%</span> </span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(coefs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 9
# Groups:   TAXA [4]
  TAXA                data     model term    edf ref.df statistic p.value    Rsq
  &lt;chr&gt;               &lt;list&gt;   &lt;lis&gt; &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;
1 Birds               &lt;tibble&gt; &lt;gam&gt; s(ye…  1.69      9      7.14 0       0.159 
2 Fish                &lt;tibble&gt; &lt;gam&gt; s(ye…  6.61      9      3.85 6.33e-6 0.0740
3 Marine invertebrat… &lt;tibble&gt; &lt;gam&gt; s(ye…  7.59      9     15.5  0       0.488 
4 Terrestrial plants  &lt;tibble&gt; &lt;gam&gt; s(ye…  6.87      9     13.7  0       0.364 </code></pre>
</div>
</div>
<p>We can also perform ANOVA</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>rich_plot <span class="sc">%&gt;%</span> </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">filter</span>(n_year<span class="sc">&gt;</span><span class="dv">30</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">group_by</span>(TAXA) <span class="sc">%&gt;%</span> </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="fu">nest</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> purrr<span class="sc">::</span><span class="fu">map</span>(data, <span class="sc">~</span><span class="fu">aov</span>(richness <span class="sc">~</span> CLIMATE, <span class="at">data=</span>.x)),</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">coefs =</span> purrr<span class="sc">::</span><span class="fu">map</span>(model, tidy, <span class="at">conf.int =</span> F)) <span class="sc">%&gt;%</span> </span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(coefs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 9
# Groups:   TAXA [4]
  TAXA              data     model term     df  sumsq meansq statistic   p.value
  &lt;chr&gt;             &lt;list&gt;   &lt;lis&gt; &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1 Birds             &lt;tibble&gt; &lt;aov&gt; CLIM…     1 1.95e3 1.95e3      9.65  2.05e- 3
2 Birds             &lt;tibble&gt; &lt;aov&gt; Resi…   354 7.15e4 2.02e2     NA    NA       
3 Fish              &lt;tibble&gt; &lt;aov&gt; CLIM…     1 1.85e5 1.85e5     75.1   1.27e-16
4 Fish              &lt;tibble&gt; &lt;aov&gt; Resi…   384 9.48e5 2.47e3     NA    NA       
5 Marine invertebr… &lt;tibble&gt; &lt;aov&gt; CLIM…     1 9.97e4 9.97e4     21.8   6.88e- 6
6 Marine invertebr… &lt;tibble&gt; &lt;aov&gt; Resi…   142 6.49e5 4.57e3     NA    NA       
7 Terrestrial plan… &lt;tibble&gt; &lt;aov&gt; CLIM…     1 1.05e6 1.05e6    181.    3.90e-30
8 Terrestrial plan… &lt;tibble&gt; &lt;aov&gt; Resi…   209 1.21e6 5.77e3     NA    NA       </code></pre>
</div>
</div>
<p>Tukey test and so on</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>rich_plot <span class="sc">%&gt;%</span> </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">filter</span>(n_year<span class="sc">&gt;</span><span class="dv">30</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">group_by</span>(TAXA) <span class="sc">%&gt;%</span> </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="fu">nest</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> purrr<span class="sc">::</span><span class="fu">map</span>(data, <span class="sc">~</span><span class="fu">TukeyHSD</span>(<span class="fu">aov</span>(richness <span class="sc">~</span> CLIMATE, <span class="at">data=</span>.x))),</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">coefs =</span> purrr<span class="sc">::</span><span class="fu">map</span>(model, tidy, <span class="at">conf.int =</span> F)) <span class="sc">%&gt;%</span> </span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(coefs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 10
# Groups:   TAXA [4]
  TAXA           data     model      term  contrast null.value estimate conf.low
  &lt;chr&gt;          &lt;list&gt;   &lt;list&gt;     &lt;chr&gt; &lt;chr&gt;         &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
1 Birds          &lt;tibble&gt; &lt;TukeyHSD&gt; CLIM… Tempera…          0     7.58     2.78
2 Fish           &lt;tibble&gt; &lt;TukeyHSD&gt; CLIM… Tempera…          0    54.6     42.2 
3 Marine invert… &lt;tibble&gt; &lt;TukeyHSD&gt; CLIM… Tempera…          0    55.5     32.0 
4 Terrestrial p… &lt;tibble&gt; &lt;TukeyHSD&gt; CLIM… Tropica…          0   191.     163.  
# ℹ 2 more variables: conf.high &lt;dbl&gt;, adj.p.value &lt;dbl&gt;</code></pre>
</div>
</div>
<p>We can also nest the data by different groups, i.e.&nbsp;<code>taxa</code> and <code>study id</code>, in order to perform a different model for each study site and taxa.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>rich_plot <span class="sc">%&gt;%</span> </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n_year<span class="sc">&gt;</span><span class="dv">30</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">group_by</span>(TAXA,id) <span class="sc">%&gt;%</span> </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="fu">nest</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">map</span>(data, <span class="sc">~</span><span class="fu">gam</span>(richness <span class="sc">~</span> <span class="fu">s</span>(year, <span class="at">bs =</span> <span class="st">"cs"</span>,<span class="at">k=</span><span class="sc">-</span><span class="dv">1</span>), <span class="at">data=</span>.x)),</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">coefs =</span> <span class="fu">map</span>(model, tidy, <span class="at">conf.int =</span> <span class="cn">TRUE</span>),</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">Rsq =</span> <span class="fu">map_dbl</span>(model, <span class="sc">~</span><span class="fu">summary</span>(.)<span class="sc">$</span>r.sq)) <span class="sc">%&gt;%</span> </span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(coefs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24 × 10
# Groups:   TAXA, id [24]
      id TAXA         data     model term    edf ref.df statistic p.value    Rsq
   &lt;dbl&gt; &lt;chr&gt;        &lt;list&gt;   &lt;lis&gt; &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;
 1    39 Birds        &lt;tibble&gt; &lt;gam&gt; s(ye…  7.98      9     6.13  1.23e-5 0.538 
 2    46 Birds        &lt;tibble&gt; &lt;gam&gt; s(ye…  7.88      9    39.3   0       0.884 
 3    57 Fish         &lt;tibble&gt; &lt;gam&gt; s(ye…  7.29      9    12.2   1.80e-7 0.774 
 4   117 Marine inve… &lt;tibble&gt; &lt;gam&gt; s(ye…  8.33      9     4.36  4.04e-4 0.438 
 5   119 Fish         &lt;tibble&gt; &lt;gam&gt; s(ye…  8.50      9    29.3   0       0.866 
 6   147 Marine inve… &lt;tibble&gt; &lt;gam&gt; s(ye…  3.72      9     0.852 9.11e-2 0.0979
 7   148 Fish         &lt;tibble&gt; &lt;gam&gt; s(ye…  7.85      9    84.1   0       0.953 
 8   178 Fish         &lt;tibble&gt; &lt;gam&gt; s(ye…  5.84      9    21.6   0       0.835 
 9   214 Terrestrial… &lt;tibble&gt; &lt;gam&gt; s(ye…  7.45      9    50.0   0       0.837 
10   278 Fish         &lt;tibble&gt; &lt;gam&gt; s(ye…  7.23      9    22.1   0       0.835 
# ℹ 14 more rows</code></pre>
</div>
</div>
<p>Just for information, if you are using the latest version of <code>dplyr</code> (1.0.0), you can use <code>nest_by()</code> instead of <code>group_by()</code> and <code>nest()</code>. With this approach we skip using <code>mutate</code> and <code>map</code> and use <code>summarise()</code> instead.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>rich_plot <span class="sc">%&gt;%</span> </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n_year<span class="sc">&gt;</span><span class="dv">30</span>, CLIMATE<span class="sc">==</span><span class="st">"Temperate"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  ungroup <span class="sc">%&gt;%</span> </span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="fu">nest_by</span>(TAXA,id) <span class="sc">%&gt;%</span> </span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">list</span>(<span class="fu">gam</span>(richness <span class="sc">~</span> <span class="fu">s</span>(year, <span class="at">bs =</span> <span class="st">"cs"</span>,<span class="at">k=</span><span class="sc">-</span><span class="dv">1</span>), <span class="at">data=</span>data))) <span class="sc">%&gt;%</span> </span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(<span class="fu">tidy</span>(model, <span class="at">conf.int =</span> <span class="cn">TRUE</span>))<span class="co"># %&gt;% </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 19 × 7
# Groups:   TAXA, id [19]
   TAXA                    id term      edf ref.df statistic     p.value
   &lt;chr&gt;                &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;       &lt;dbl&gt;
 1 Birds                   39 s(year) 7.98       9     6.13  0.0000123  
 2 Birds                   46 s(year) 7.88       9    39.3   0          
 3 Birds                  339 s(year) 5.59       9     7.03  0          
 4 Birds                  360 s(year) 3.13       9     1.15  0.0211     
 5 Birds                  363 s(year) 0.805      9     0.313 0.0595     
 6 Birds                  413 s(year) 6.93       9    19.0   0          
 7 Birds                  414 s(year) 7.88       9    35.6   0          
 8 Fish                    57 s(year) 7.29       9    12.2   0.000000180
 9 Fish                   119 s(year) 8.50       9    29.3   0          
10 Fish                   178 s(year) 5.84       9    21.6   0          
11 Fish                   288 s(year) 7.67       9    19.4   0          
12 Fish                   428 s(year) 8.77       9    56.7   0          
13 Fish                   430 s(year) 4.46       9    17.0   0          
14 Fish                   431 s(year) 5.82       9    10.8   0          
15 Marine invertebrates   117 s(year) 8.33       9     4.36  0.000404   
16 Marine invertebrates   147 s(year) 3.72       9     0.852 0.0911     
17 Terrestrial plants     214 s(year) 7.45       9    50.0   0          
18 Terrestrial plants     298 s(year) 5.58       9    10.1   0          
19 Terrestrial plants     355 s(year) 8.11       9    42.7   0          </code></pre>
</div>
</div>
</section>
<section id="generating-tables-from-model-output" class="level1">
<h1>Generating tables from model output</h1>
<p>As I said before, with <code>broom</code> we can perform the models and report organized tables. We don’t need to copy and paste the output, risking to mess up the results. Also, if the analysis change we don’t have to delete the old tables, we simply generate a new one.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pander)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>model_tab<span class="ot">&lt;-</span>rich_plot <span class="sc">%&gt;%</span> </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n_year<span class="sc">&gt;</span><span class="dv">30</span>, CLIMATE<span class="sc">==</span><span class="st">"Temperate"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  ungroup <span class="sc">%&gt;%</span> </span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="fu">nest_by</span>(TAXA,id) <span class="sc">%&gt;%</span> </span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">list</span>(<span class="fu">gam</span>(richness <span class="sc">~</span> <span class="fu">s</span>(year, <span class="at">bs =</span> <span class="st">"cs"</span>,<span class="at">k=</span><span class="sc">-</span><span class="dv">1</span>), <span class="at">data=</span>data))) <span class="sc">%&gt;%</span> </span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(<span class="fu">tidy</span>(model, <span class="at">conf.int =</span> <span class="cn">TRUE</span>))</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="fu">pander</span>(model_tab)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 28%">
<col style="width: 7%">
<col style="width: 12%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 14%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">TAXA</th>
<th style="text-align: center;">id</th>
<th style="text-align: center;">term</th>
<th style="text-align: center;">edf</th>
<th style="text-align: center;">ref.df</th>
<th style="text-align: center;">statistic</th>
<th style="text-align: center;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Birds</td>
<td style="text-align: center;">39</td>
<td style="text-align: center;">s(year)</td>
<td style="text-align: center;">7.981</td>
<td style="text-align: center;">9</td>
<td style="text-align: center;">6.132</td>
<td style="text-align: center;">1.23e-05</td>
</tr>
<tr class="even">
<td style="text-align: center;">Birds</td>
<td style="text-align: center;">46</td>
<td style="text-align: center;">s(year)</td>
<td style="text-align: center;">7.878</td>
<td style="text-align: center;">9</td>
<td style="text-align: center;">39.29</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Birds</td>
<td style="text-align: center;">339</td>
<td style="text-align: center;">s(year)</td>
<td style="text-align: center;">5.586</td>
<td style="text-align: center;">9</td>
<td style="text-align: center;">7.027</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: center;">Birds</td>
<td style="text-align: center;">360</td>
<td style="text-align: center;">s(year)</td>
<td style="text-align: center;">3.131</td>
<td style="text-align: center;">9</td>
<td style="text-align: center;">1.147</td>
<td style="text-align: center;">0.02115</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Birds</td>
<td style="text-align: center;">363</td>
<td style="text-align: center;">s(year)</td>
<td style="text-align: center;">0.8045</td>
<td style="text-align: center;">9</td>
<td style="text-align: center;">0.3126</td>
<td style="text-align: center;">0.05949</td>
</tr>
<tr class="even">
<td style="text-align: center;">Birds</td>
<td style="text-align: center;">413</td>
<td style="text-align: center;">s(year)</td>
<td style="text-align: center;">6.934</td>
<td style="text-align: center;">9</td>
<td style="text-align: center;">19.03</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Birds</td>
<td style="text-align: center;">414</td>
<td style="text-align: center;">s(year)</td>
<td style="text-align: center;">7.879</td>
<td style="text-align: center;">9</td>
<td style="text-align: center;">35.62</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: center;">Fish</td>
<td style="text-align: center;">57</td>
<td style="text-align: center;">s(year)</td>
<td style="text-align: center;">7.292</td>
<td style="text-align: center;">9</td>
<td style="text-align: center;">12.23</td>
<td style="text-align: center;">1.805e-07</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Fish</td>
<td style="text-align: center;">119</td>
<td style="text-align: center;">s(year)</td>
<td style="text-align: center;">8.504</td>
<td style="text-align: center;">9</td>
<td style="text-align: center;">29.35</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: center;">Fish</td>
<td style="text-align: center;">178</td>
<td style="text-align: center;">s(year)</td>
<td style="text-align: center;">5.844</td>
<td style="text-align: center;">9</td>
<td style="text-align: center;">21.58</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Fish</td>
<td style="text-align: center;">288</td>
<td style="text-align: center;">s(year)</td>
<td style="text-align: center;">7.669</td>
<td style="text-align: center;">9</td>
<td style="text-align: center;">19.42</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: center;">Fish</td>
<td style="text-align: center;">428</td>
<td style="text-align: center;">s(year)</td>
<td style="text-align: center;">8.768</td>
<td style="text-align: center;">9</td>
<td style="text-align: center;">56.65</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Fish</td>
<td style="text-align: center;">430</td>
<td style="text-align: center;">s(year)</td>
<td style="text-align: center;">4.459</td>
<td style="text-align: center;">9</td>
<td style="text-align: center;">17.01</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: center;">Fish</td>
<td style="text-align: center;">431</td>
<td style="text-align: center;">s(year)</td>
<td style="text-align: center;">5.822</td>
<td style="text-align: center;">9</td>
<td style="text-align: center;">10.8</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Marine invertebrates</td>
<td style="text-align: center;">117</td>
<td style="text-align: center;">s(year)</td>
<td style="text-align: center;">8.328</td>
<td style="text-align: center;">9</td>
<td style="text-align: center;">4.364</td>
<td style="text-align: center;">0.0004043</td>
</tr>
<tr class="even">
<td style="text-align: center;">Marine invertebrates</td>
<td style="text-align: center;">147</td>
<td style="text-align: center;">s(year)</td>
<td style="text-align: center;">3.715</td>
<td style="text-align: center;">9</td>
<td style="text-align: center;">0.8522</td>
<td style="text-align: center;">0.09115</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Terrestrial plants</td>
<td style="text-align: center;">214</td>
<td style="text-align: center;">s(year)</td>
<td style="text-align: center;">7.454</td>
<td style="text-align: center;">9</td>
<td style="text-align: center;">49.96</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: center;">Terrestrial plants</td>
<td style="text-align: center;">298</td>
<td style="text-align: center;">s(year)</td>
<td style="text-align: center;">5.584</td>
<td style="text-align: center;">9</td>
<td style="text-align: center;">10.09</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Terrestrial plants</td>
<td style="text-align: center;">355</td>
<td style="text-align: center;">s(year)</td>
<td style="text-align: center;">8.107</td>
<td style="text-align: center;">9</td>
<td style="text-align: center;">42.72</td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="bootstrap-with-modelr" class="level1">
<h1>Bootstrap with <code>modelr</code></h1>
<p>We can try to perform a bootstrap (a few times) and visualize how the species richness of different taxa is changing over time.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>boots_rich <span class="ot">&lt;-</span> rich_plot <span class="sc">%&gt;%</span> </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n_year<span class="sc">&gt;</span><span class="dv">30</span>, CLIMATE<span class="sc">==</span><span class="st">"Temperate"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  ungroup <span class="sc">%&gt;%</span> </span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(TAXA,id) <span class="sc">%&gt;%</span> </span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">do</span>(<span class="at">rs =</span> modelr<span class="sc">::</span><span class="fu">bootstrap</span>(., <span class="dv">10</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(rs) <span class="sc">%&gt;%</span> </span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(TAXA,id,.id) <span class="sc">%&gt;%</span> </span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">map</span>(data, <span class="sc">~</span><span class="fu">augment</span>(<span class="fu">gam</span>(richness <span class="sc">~</span> <span class="fu">s</span>(year, <span class="at">bs=</span><span class="st">"cs"</span>, <span class="at">k=</span><span class="sc">-</span><span class="dv">1</span>),</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link=</span><span class="st">"log"</span>),</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">data =</span> <span class="fu">as.data.frame</span>(.<span class="sc">$</span>strap))))) <span class="sc">%&gt;%</span> </span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We have taxa, study id and <code>.id</code> representing each bootstrap.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>boots_rich</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8,980 × 12
# Groups:   TAXA, id, .id [190]
   TAXA     id .id   data     richness  year .fitted .se.fit  .resid   .hat
   &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt; &lt;list&gt;      &lt;int&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;
 1 Birds    39 01    &lt;tibble&gt;       24  2014    3.09  0.0650  0.412  0.0932
 2 Birds    39 01    &lt;tibble&gt;       20  1986    2.99  0.0458  0.0443 0.0415
 3 Birds    39 01    &lt;tibble&gt;       18  1998    3.00  0.0432 -0.472  0.0375
 4 Birds    39 01    &lt;tibble&gt;       19  2009    3.06  0.0482 -0.500  0.0494
 5 Birds    39 01    &lt;tibble&gt;       25  1992    2.99  0.0449  1.11   0.0399
 6 Birds    39 01    &lt;tibble&gt;       16  1984    2.99  0.0467 -0.892  0.0433
 7 Birds    39 01    &lt;tibble&gt;       21  1982    2.99  0.0483  0.243  0.0464
 8 Birds    39 01    &lt;tibble&gt;       24  1975    3.01  0.0648  0.801  0.0853
 9 Birds    39 01    &lt;tibble&gt;       19  1979    3.00  0.0529 -0.236  0.0562
10 Birds    39 01    &lt;tibble&gt;       23  2011    3.07  0.0534  0.306  0.0615
# ℹ 8,970 more rows
# ℹ 2 more variables: .sigma &lt;lgl&gt;, .cooksd &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Using <code>mutate()</code> we can get both upper and lower confidence intervals</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>boots_ci <span class="ot">&lt;-</span> boots_rich <span class="sc">%&gt;%</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lower =</span> .fitted <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> .se.fit,</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="at">upper =</span> .fitted <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> .se.fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Visualize confidence intervals with <code>geom_ribbon()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>upper_lower <span class="ot">&lt;-</span> boots_ci <span class="sc">%&gt;%</span> </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(TAXA) <span class="sc">%&gt;%</span> </span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">plot =</span> <span class="fu">map2</span>(data, TAXA, <span class="sc">~</span><span class="fu">ggplot</span>(<span class="at">data =</span> .x, <span class="fu">aes</span>(<span class="at">x=</span>year, <span class="at">y =</span> .fitted, , <span class="at">fill =</span> <span class="fu">as.factor</span>(id)))<span class="sc">+</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha=</span>.<span class="dv">005</span>)<span class="sc">+</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>lower, <span class="at">ymax=</span>upper, <span class="at">group=</span><span class="fu">interaction</span>(.id, <span class="fu">as.factor</span>(id))),<span class="at">linetype=</span><span class="dv">0</span>,<span class="at">alpha=</span><span class="fl">0.2</span>)<span class="sc">+</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="fu">glue</span>(<span class="st">"Species richness change of {.y} over time"</span>))<span class="sc">+</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span>  <span class="st">"Ribbon shows 95% bootstrapped percentile confidence interval"</span>,</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Study ID"</span>,</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"log(Species richness)"</span>)<span class="sc">+</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">alpha =</span> <span class="dv">1</span>)))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can store each plot as an object</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>boots_birds <span class="ot">&lt;-</span> upper_lower<span class="sc">$</span>plot[[<span class="dv">1</span>]]</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>boots_fish <span class="ot">&lt;-</span> upper_lower<span class="sc">$</span>plot[[<span class="dv">2</span>]]<span class="sc">+</span><span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>,<span class="dv">6</span>))</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>boots_marine<span class="ot">&lt;-</span> upper_lower<span class="sc">$</span>plot[[<span class="dv">3</span>]]</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>boots_plants<span class="ot">&lt;-</span> upper_lower<span class="sc">$</span>plot[[<span class="dv">4</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And combine them with <code>cowplot::plot_grid()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_grid</span>(boots_birds, boots_fish,</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>          boots_marine, boots_plants, <span class="at">ncol=</span><span class="dv">2</span>, <span class="at">nrow=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Well.. some studies seem to be 💩 fitted, others not that much. Next step, I’d check the estimates of our bootstraps, explore a bit more those well fitted models, and try to improve the bad ones.</p>
<p>I’m still a beginner in <code>tidymodels</code>. If you are interested in learning more about tidymodels / predictions / bootstraps etc, I recommend following <a href="https://www.youtube.com/channel/UCTTBgWyJl2HrrhQOOc710kA">Julia Silge’s channel on youtube</a>.</p>
<p>If you find any mistakes, have suggestions or queries, please just drop me a DM on twitter or leave a comment here (hope it is working now 😄).</p>
<p><img src="https://media.giphy.com/media/7itDy9n1794vC/giphy.gif" class="img-fluid"></p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
    } else {
      disableStylesheet(alternateStylesheets);
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } 
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>